{% extends "base.html" %}

{% block title %}Cr√©er une VM - VMaster{% endblock %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='create.css') }}">

<div class="create-container">
  <!-- Partie gauche : Texte explicatif -->
  <div class="info-section">
    <h1>üñ•Ô∏è Cr√©er une Machine Virtuelle</h1>
    <p>
      Configurez votre machine virtuelle selon vos besoins avec VMaster. 
      Choisissez le syst√®me d'exploitation, la puissance de calcul, la m√©moire, 
      l'espace disque et, si besoin, ajoutez un script pour l'automatisation.
    </p>
    
    <div class="system-requirements">
      <h3>üìã Configuration recommand√©e :</h3>
      <ul>
        <li><strong>Ubuntu/Debian :</strong> 2+ CPU, 2+ Go RAM, 20+ Go stockage</li>
        <li><strong>CentOS :</strong> 2+ CPU, 2+ Go RAM, 20+ Go stockage</li>
        <li><strong>Windows :</strong> 2+ CPU, 4+ Go RAM, 40+ Go stockage</li>
      </ul>
    </div>

  </div>

  <!-- Partie droite : Formulaire -->
  <div class="form-section">
    <form action="/create" method="POST">
      
      <label for="name">üñ•Ô∏è Nom de la VM</label>
      <input type="text" id="name" name="name" placeholder="Ex : VM-Ubuntu-Server" 
             pattern="[a-zA-Z0-9-_ ]+" title="Lettres, chiffres, espaces, tirets et underscores uniquement"
             required>
      
      <!-- Choix OS √©tendu -->
      <label for="os">üß¨ Syst√®me d'exploitation</label>
      <select id="os" name="os" required>
        <option value="" disabled selected>-- S√©lectionnez un OS --</option>
        <optgroup label="Distributions Linux">
          <option value="ubuntu">Ubuntu 22.04</option>
          <option value="debian">Debian 12</option>
          <option value="centos">CentOS 8</option>
          <option value="fedora">Fedora</option>
          <option value="archlinux">Arch Linux</option>
          <option value="opensuse">openSUSE</option>
          <option value="gentoo">Gentoo</option>
          <option value="linux">Autre Linux</option>
        </optgroup>
        <optgroup label="Syst√®mes Windows">
          <option value="windows">Windows Server 2019</option>
          <option value="windows10">Windows 10</option>
          <option value="windows11">Windows 11</option>
        </optgroup>
        <optgroup label="Autres syst√®mes">
          <option value="freebsd">FreeBSD</option>
          <option value="solaris">Solaris</option>
          <option value="oracle">Oracle Linux</option>
        </optgroup>
      </select>

      <!-- CPU avec meilleure validation -->
      <label for="cpu">‚öôÔ∏è Nombre de CPU (1-32)</label>
      <input type="number" id="cpu" name="cpu" min="1" max="32" 
             value="2" required placeholder="Ex : 2">
      <div class="range-indicator">
        <span>Faible</span>
        <input type="range" min="1" max="32" value="2" class="cpu-range" 
               oninput="document.getElementById('cpu').value = this.value">
        <span>√âlev√©</span>
      </div>

      <!-- RAM avec indicateur visuel -->
      <label for="ram">üíæ M√©moire RAM (1-128 Go)</label>
      <input type="number" id="ram" name="ram" min="1" max="128" 
             value="4" required placeholder="Ex : 4">
      <div class="range-indicator">
        <span>1 Go</span>
        <input type="range" min="1" max="128" value="4" class="ram-range"
               oninput="document.getElementById('ram').value = this.value">
        <span>128 Go</span>
      </div>

      <!-- Stockage avec indicateur visuel -->
      <label for="storage">üì¶ Stockage (10-1000 Go)</label>
      <input type="number" id="storage" name="storage" min="10" max="1000" 
             value="50" required placeholder="Ex : 50">
      <div class="range-indicator">
        <span>10 Go</span>
        <input type="range" min="10" max="1000" value="50" class="storage-range"
               oninput="document.getElementById('storage').value = this.value">
        <span>1000 Go</span>
      </div>

      <!-- Script optionnel am√©lior√© -->
      <label for="script">üìú Script de post-installation (optionnel)</label>
      <textarea id="script" name="script" rows="5" placeholder="#!/bin/bash
# Exemple : Mise √† jour automatique
sudo apt update && sudo apt upgrade -y

# Exemple : Installation de paquets
# sudo apt install -y nginx mysql-server

# Exemple : Configuration r√©seau
# echo 'Hello from VMaster!' > /var/www/html/index.html"></textarea>
      <small class="help-text">Ce script sera ex√©cut√© apr√®s l'installation du syst√®me</small>

      <!-- Options avanc√©es -->
      <div class="advanced-options">
        <h4>‚öôÔ∏è Options avanc√©es</h4>
        
        <label for="network_type">üåê Type de r√©seau</label>
        <select id="network_type" name="network_type">
          <option value="nat" selected>NAT (recommand√©)</option>
          <option value="bridged">Bridge</option>
          <option value="hostonly">hostonly</option>
        </select>

        <label for="graphics_controller">üéÆ Contr√¥leur graphique</label>
        <select id="graphics_controller" name="graphics_controller">
          <option value="vmsvga" selected>VMSVGA (recommand√©)</option>
          <option value="vboxsvga">VBoxSVGA</option>
          <option value="vboxvga">VBoxVGA</option>
        </select>

        <label for="vram">üé• M√©moire vid√©o (MB)</label>
        <input type="number" id="vram" name="vram" min="16" max="256" value="128">
      </div>

      <!-- Conteneur pour les boutons -->
      <div class="button-container">
        <button type="submit" class="btn-create">üöÄ Cr√©er la VM</button>
        <button type="reset" class="btn-reset">üîÑ Annuler</button>
      </div>
    </form>
  </div>
</div>

<script>
// Mise √† jour des sliders lorsque les inputs num√©riques changent
document.getElementById('cpu').addEventListener('input', function() {
  document.querySelector('.cpu-range').value = this.value;
});

document.getElementById('ram').addEventListener('input', function() {
  document.querySelector('.ram-range').value = this.value;
});

document.getElementById('storage').addEventListener('input', function() {
  document.querySelector('.storage-range').value = this.value;
});

// Validation du nom de la VM
document.getElementById('name').addEventListener('input', function() {
  const regex = /^[a-zA-Z0-9-_ ]+$/;
  if (!regex.test(this.value)) {
    this.setCustomValidity('Caract√®res autoris√©s : lettres, chiffres, espaces, tirets et underscores');
  } else {
    this.setCustomValidity('');
  }
});

// Affichage des recommandations selon l'OS s√©lectionn√©
document.getElementById('os').addEventListener('change', function() {
  const os = this.value;
  const cpuInput = document.getElementById('cpu');
  const ramInput = document.getElementById('ram');
  const storageInput = document.getElementById('storage');
  
  switch(os) {
    case 'ubuntu':
    case 'debian':
    case 'centos':
    case 'fedora':
    case 'archlinux':
    case 'opensuse':
    case 'gentoo':
    case 'linux':
      cpuInput.value = 2;
      ramInput.value = 2;
      storageInput.value = 20;
      break;
    case 'windows':
    case 'windows10':
    case 'windows11':
      cpuInput.value = 2;
      ramInput.value = 4;
      storageInput.value = 40;
      break;
    case 'freebsd':
    case 'solaris':
    case 'oracle':
      cpuInput.value = 2;
      ramInput.value = 2;
      storageInput.value = 25;
      break;
  }
});
</script>
{% endblock %}